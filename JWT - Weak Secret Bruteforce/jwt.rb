#!/usr/bin/ruby

require 'base64'
require 'openssl'

puts "Enter the JWT Token: "
STDOUT.flush  
jwt = gets.chomp

header, payload, signature = jwt.split('.')

puts "\n"

decoded_payload = Base64.decode64(payload)
puts "Enter the existing value of claim you want to change in Payload Section: "
existing1 = gets.chomp
puts "\n"
puts "Enter the new value of claim you want to use in Payload Section: "
new1 = gets.chomp
puts "\n"
decoded_payload.gsub!(existing1, new1)
puts "The new payload is: "+decoded_payload
new_payload = Base64.strict_encode64(decoded_payload).gsub("=", "")
puts "\n"

data = header+"."+new_payload

puts "Enter the secret: "
STDOUT.flush  
secret_key = gets.chomp

signature = Base64.urlsafe_encode64(OpenSSL::HMAC.digest(OpenSSL::Digest.new("sha256"), secret_key, data))
puts "The new JWT signature is: "+ data+"."+signature
puts "\n"